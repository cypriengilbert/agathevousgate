{% extends 'base.html.twig' %} {% block body %}
<style>

  @media (min-width: 768px) {
  .validate_cart_button{
    background-color:#242258;
    cursor:pointer;
    height:40px;
    border-radius:20px;
    margin-top:30px;
  }

  .see_generic p{

  color:white;
  line-height:30px;
  padding-right:10px;
   padding-top:5px;
   padding-left:10px 

  }
  .validate_cart_button p{
    color:white;
    line-height:30px;
    padding-right:10px;
     padding-top:5px;
     padding-left:10px 
  }
  .see_generic{

  width:100%;
  height:40px;
  margin-top:20px;
    cursor:pointer;

  }
  }
  @media (max-width: 768px) {
  .see_generic{

  width:50%;
  height:40px;
  position:fixed;
    bottom:0px;
    cursor:pointer;

  }
  .see_generic p{

  color:white;
  line-height:15px;
  padding-right:10px;
   padding-top:5px;
   padding-left:10px 

  }
  .validate_cart_button{
    background-color:#242258;
    position:fixed;
    bottom:0px;
    width:100%;
    min-height:40px;
    cursor:pointer;
    z-index: 1000;
  }
  .validate_cart_button p{
    color:white;
    line-height:30px;
    padding-right:10px;
     padding-top:5px;
     padding-left:10px 
  }
}
</style>
<body>
    <div class="container">
    <h1 class="text-center">
    {% if collection1 is null %}
    Couleurs unies
    {% else %}
    Collection {{ collection1.title}}
    {% endif %}
    </h1>
    <div class="row">
   {# <div class="col-sm-2 no_padding">
    <a  style="position:fixed" href="{{path('boutique_collection', {'name': 'Basic' })}}">Couleurs unies</a>
    {% for collectionList in allCollection %}
    <a  style="position:fixed" href="{{path('boutique_collection', {'name': collectionList.title })}}">{{ collectionList.title }}</a><br>

    {% endfor %}


    </div> #}
    <div class="col-sm-2 no_padding">
    </div>
    <div class="col-sm-8 no_padding">
        {% for color in colors %}

          {% if (collection1 is null and color.isBasic == 1 and color.isActive == 1) or (collection1 and color.isBasic == 0 and color.isActive == 1)  %}
        <div class="row">
        <script>
        function open_div_{{color.id}}(){
          if(document.getElementById('collapse{{color.id}}').className == 'panel-collapse collapse in'){
          document.getElementById('collapse{{color.id}}').className='panel-collapse collapse';
        }
        else{
        document.getElementById('collapse{{color.id}}').className='panel-collapse collapse in';
        }
        }
        </script>
           <div class="col-sm-12 no_padding">
              <div class="panel-group" id="accordion">
                 <div class="panel panel-default" style="margin-top:20px; background-color:white;">
                    <div id="panel-heading-coffret" class="panel-heading panel-heading-plugin" style="background:url({{ asset('/upload/color/thumbnail/' ~ color.imageColorName)}});" onclick="open_div_{{color.id}}();">
                       <div class="row">
                          <div class="col-sm-11">
                             <h3 class="panel-title" >
                             <span style="background-color:white">{{color.name_public}} <span id="nb-item-{{color.id}}"></span></span>
                             </h3>
                          </div>
                          <div class="col-sm-1 text-right">
                          </div>
                       </div>
                    </div>
                    <div id="collapse{{color.id}}" class="panel-collapse collapse" style="background-color:white;">
                       <div class="panel-body">
                          <div class="row">
                            <div class="col-sm-1">
                            </div>
                          {% for product in products %}
                            <div class="col-sm-2">
                              <div class="row">
                                <div class="col-sm-12 text-center" style="min-height: 50px; " >
                                {{product.cartname}}
                                </div>
                              </div>
                              <div class="row">
                                <div class="col-sm-12 text-center" style="margin-top:10px" >
                                  <img src="{{ asset('/upload/product/' ~ product.imageProductName)}}" style="max-width:100%;height:30px">
                                </div>
                              </div>
                              <div class="row">
                                <div class="col-sm-12 text-center" style="margin-top:10px; text-align:center">
                                <input style="width:100%;"  type="number" class="form-control" id="quantity_{{product.id}}_{{color.id}}" name="" value="0" min="0" onchange="refresh_items('{{color.id}}');">                                      </center>

                                </div>
                              </div>
                            </div>

                            {% endfor %}
                            <div class="col-sm-1">
                            </div>
                          </div>
                       </div>
                    </div>

                 </div>
              </div>
           </div>

        </div>
        {% endif %}
    {% endfor %}
    </div>
    <div class="col-sm-2 no_padding">
    </div>

   
    </div>
    <div class="row">
        <div class="col-sm-2 no_padding">
        </div>
        <div class="col-sm-8 no_padding">

          <div class="validate_cart_button  text-center" onclick="addtocart()"  >
               <p style=""><span class="glyphicon glyphicon-shopping-cart"></span> Ajouter <span id='nb_item_pending'></span> au panier </p>
          </div>
             {#<a href="{{ path('generic')}}"><div class="see_generic text-center" style=" background-color:#A94141;" >
                     <p style=""> Voir les produits génériques </p>
             </a>#}
        </div>
            <div class="col-sm-2 no_padding">
    </div>
    </div>

</div>

      

       
</body>




<script>
function addtocart(){
var finalCart = [];
  {% for color in colors %}
   {% if (collection1 is null and color.isBasic == 1 and color.isActive == 1) or (collection1 and color.isBasic == 0 and color.isActive == 1)  %}
    {% for product in products %}
        value = document.getElementById('quantity_{{product.id}}_{{color.id}}').value;

        finalCart.push([{{product.id}},{{color.id}},value ]);
    {% endfor %}
    {% endif %}
  {% endfor %}
  var finalJsonCart = JSON.stringify(finalCart);

  var frm = document.getElementById('finalCartField') || null;
  if(frm) {
   frm.value = finalJsonCart;
}
document.getElementById("buttonValidateCart").click();

}

</script>
<div style="display:none">
{% if collection1 is null %}

<form action="{{path('addBoutiqueToCart', {'name': 'Basic'} )}}"  method="post" id="redirect-form" name="redirect-form">    {% else %}
<form action="{{path('addBoutiqueToCart', {'name': collection1.title} )}}"  method="post" id="redirect-form" name="redirect-form">    {% endif %}




  <input type="text" name="finalCart" id="finalCartField" >
  <button type="submit" id="buttonValidateCart">Valider</button>
</form>
</div>

<script>
  function refresh_items(color_id){
  var id = 'nb-item-'+color_id;
  var value = 0;
   {% for product in products %}
   value += parseInt(document.getElementById('quantity_{{product.id}}_'+color_id).value);
  {% endfor %}
  if (value == 0) {
  document.getElementById(id).innerHTML = '';
  }
  else if (value == 1){
  document.getElementById(id).innerHTML = '- '+value+' produit séléctionné';
  }
  else{
  document.getElementById(id).innerHTML = '- '+value+' produits séléctionnés';
  }
var value_total = 0;
{% for color in colors %}
   {% if (collection1 is null and color.isBasic == 1 and color.isActive == 1) or (collection1 and color.isBasic == 0 and color.isActive == 1)  %}
    {% for product in products %}
        value_total += parseInt(document.getElementById('quantity_{{product.id}}_{{color.id}}').value);
    {% endfor %}
    {% endif %}
{% endfor %}

if (value == 0) {
  document.getElementById('nb_item_pending').innerHTML ='';
  }
  else if (value == 1){
  document.getElementById('nb_item_pending').innerHTML = value_total+' article';
  }
  else{
  document.getElementById('nb_item_pending').innerHTML = value_total+' articles';
  }
  }
</script>
{% endblock %}
